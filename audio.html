<!DOCTYPE html>
<html lang="kk-Cyrl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="site_title">ҮМІТ | Аудио Плеер (Неон)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Montserrat:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="stylesheet" href="style.css"> 

</head>
<body>
    
    <div class="top-nav">
        <button class="icon-btn" onclick="openLanguageModal()"><i class="fas fa-language"></i></button>

        <div class="profile-section">
            <button class="icon-btn" id="profile-btn" onclick="toggleProfileDropdown()">
                <i class="fas fa-user-circle"></i>
            </button>
            
            <div class="profile-dropdown" id="profile-dropdown">
                <a href="#" class="profile-item" id="auth-link" data-key="login_register"><i class="fas fa-sign-in-alt"></i> Кіру / Тіркелу</a>
                <a href="#" class="profile-item" id="settings-link" style="display:none;" data-key="profile_settings"><i class="fas fa-cog"></i> Профиль Настройкалары</a>
                <a href="#" class="profile-item" id="logout-link" style="display:none;" data-key="logout"><i class="fas fa-sign-out-alt"></i> Шығу</a>
            </div>
        </div>
    </div>

    <div class="container">
        <a href="index.html" class="back-link" data-key="back_link">
            <i class="fas fa-arrow-left"></i> Артқа Қайту (Негізгі Бет)
        </a>

        <div class="header">
            <h1 data-key="audio_player_title">Аудио Өлеңдер Плеері</h1>
        </div>
        
        <div class="main-player-card">
            <span class="favorite-btn-main" id="main-favorite-btn" onclick="toggleFavorite()"><i class="far fa-heart"></i></span>
            
            <div class="cover-art"><i class="fas fa-wave-square"></i></div>
            <h2 id="current-track-title" data-key="select_track">Тректі таңдаңыз</h2>
            
            <audio id="global-audio-player" src="" preload="metadata"></audio>
            
            <div class="progress-container">
                <span id="current-time" class="time-display">0:00</span>
                <input type="range" id="progress-bar" value="0" min="0" max="100" step="0.1">
                <span id="duration" class="time-display">0:00</span>
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="skipTime(-10)"><i class="fas fa-backward"></i></button>
                <button class="control-btn main-play" id="main-play-btn" onclick="togglePlay()">
                    <i class="fas fa-play"></i>
                </button>
                <button class="control-btn" onclick="skipTime(10)"><i class="fas fa-forward"></i></button>
            </div>
        </div>
        
        <div class="playlist">
            <p class="playlist-title" data-key="playlist_title">Өлеңдер Тізімі:</p>

            <div class="search-container">
                <input type="text" id="playlist-search" data-key="search_placeholder" placeholder="Өлең атауын іздеу..." onkeyup="filterPlaylist()">
                <i class="fas fa-search search-icon"></i>
            </div>
            
            <div class="playlist-item" data-index="0">
                <div class="item-info">
                    <i class="fas fa-music"></i>
                    <span data-key="track1_title">1. Orta júz</span>
                </div>
                <div class="item-actions">
                    <span class="item-duration">0:00</span>
                    </div>
            </div>
            
            <div class="playlist-item" data-index="1">
                <div class="item-info">
                    <i class="fas fa-music"></i>
                    <span data-key="track2_title">2. Jarylgap batyr</span>
                </div>
                <div class="item-actions">
                    <span class="item-duration">0:00</span>
                    <button class="lyrics-toggle-btn" data-lyrics-index="1" data-key="lyrics_btn" onclick="toggleLyrics(this)">Мәтін</button>
                </div>
                <div class="lyrics-content" id="lyrics-1" 
                    data-lang-kk-cyrl="
                    Қазақтың ұлы аты – Қаракеерей ұраны,\n
                    Жоңғар шапқыншылығында тасқа басқан мұраны.\n
                    Көкжалдай өршіл рухты, есімі – Жарылғап,\n
                    Қырық жорық, қанды ұрыс – тарихында аңыз боп қалған.\n
                    \n
                    Бұқар жырау толғаған: 'Кернейде – Жарылғап!'\n
                    Ту ұстаған батыр деп, қатарынан қалдырмаған бағалап.\n
                    Қабанбай, Бөгенбаймен бірге қанын төккен,\n
                    Қас батырдың қадірін Қазақ елі сепкен.\n
                    Он алты жасында Қазыбек биден бата алған,\n
                    'Тархан' атағын Қытайдан да алып таңғалтқан.\n
                    Бұл – аңыз емес, жазылған тарихи дерек,\n
                    Ерлігі – үлкен даланың жадында тұрған тірек.\n
                    Жарылғап! Қанды жорықтардағы темір!\n
                    Қалба-Шаған шайқасында жеңді кебін қалмақты салып өмір.\n
                    Ол – Найманның нұры, рухы биік, ақылы да дана,\n
                    Аруағы қара бүркіт боп, қол бастаған дара!\n
                    Айласы асқан батыр, тек қана күшбен емес,\n
                    Абылай ханның қасында ақылға салып істеген.\n
                    Хантау жорығында Бетбақ арқылы қол бастап,\n
                    Қоңтайышұң қазаққа келтірген бостандық.\n
                    Байғозы батырмен бірге, барлаушы боп алда жүрген,\n
                    'Көзге түспей, шөлдетпей' – деп, екі кепілдік берген.\n
                    Бұл – Жарылғаптың әскери тактикасы, Қайрат пен ақылду ұстастырған нағыз саңғырыш.\n
                    Енді біл! Сенің тегіңде осындай көкжал бар!\n
                    Қараке тамырыңнан өсіп-өнген үлгі алар.\n
                    Оның әрбірі ерлігі – ұрпаққа өшпес мұра.\n
                    Жарылғап батырды білу – менің қанымдағы міндет!\n
                    \n<span class='author-sign'>~ Қабыкенов Сағыныш</span>"
                    data-lang-ru="
                    Великое имя казаха – знамя Каракеея,\n
                    Наследие, оставленное в камне во время Джунгарского нашествия.\n
                    С волчьим духом, имя ему – Жарылгап,\n
                    Сорок походов, кровавая битва – легенда его истории.\n
                    \n
                    Бухар Жырау пел: 'Жарылгап на Кернее!'\n
                    Не оставлял без внимания, ценя его как батыра, несущего знамя.\n
                    С Кабанбаем, Богенбаем проливал кровь вместе,\n
                    Казахский народ ценил достоинство настоящего батыра.\n
                    В шестнадцать лет получил благословение от Казыбек би,\n
                    Удивил, получив титул 'Тархан' даже от Китая.\n
                    Это не миф, а записанный исторический факт,\n
                    Его подвиг – опора, хранящаяся в памяти великой степи.\n
                    Жарылгап! Железо в кровавых походах!\n
                    В битве при Калба-Шаган победил, отправив калмаков в небытие.\n
                    Он – свет Наймана, высокий духом, мудрый и знающий,\n
                    Чей дух, как черный орел, предводительствовал!\n
                    Хитрый батыр, действовал не только силой,\n
                    Но и умом, советуясь с ханом Абылаем.\n
                    В походе на Хантау, он вел войска через Бетпак,\n
                    Принес свободу казахам от Контайшунга.\n
                    Вместе с батыром Байгозы, был разведчиком впереди,\n
                    Обещая: 'Не попадет в глаза, не замерзнет'.\n
                    Это – военная тактика Жарылгапа, истинное мужество и мудрость.\n
                    Знай же! В твоем роду есть такой волк!\n
                    Пример, выросший из корней Караке.\n
                    Каждый его подвиг – бессмертное наследие для потомков.\n
                    Знать Жарылгап батыра – долг в моей крови!\n
                    \n<span class='author-sign'>~ Кабыкенов Сагыныш</span>">
                    </div>
            </div>
            
            <div class="playlist-item" data-index="2">
                <div class="item-info">
                    <i class="fas fa-music"></i>
                    <span data-key="track3_title">3. Тегімнің рухы</span>
                </div>
                <div class="item-actions">
                    <span class="item-duration">0:00</span>
                    <button class="lyrics-toggle-btn" data-lyrics-index="2" data-key="lyrics_btn" onclick="toggleLyrics(this)">Мәтін</button>
                </div>
                <div class="lyrics-content" id="lyrics-2" 
                    data-lang-kk-cyrl="
                    Қазақпыз, тамырымыз – Алаштан нәр алған,\n
                    Үш жүзге бөлінген ұлы далам, сары алқам.\n
                    Менің тегім – Орта жүз, айбынды найзасы,\n
                    Жарқ еткен жалынды жүрек, қазақтың дара ұлы!\n
                    Ұраным – Қаптағай, төбемде тұрған ту,\n
                    Мен Найман Қаракерей, тегімді танып ұғу.\n
                    Тізедім он алты ата, керуендей созылған,\n
                    Өмірге жалғасып, көкжиектен озылған!\n
                    Ең алғаш – Байторы, тарихтың тереңінде, Келеді – Аірам, ұлы ісімен елінде.\n
                    Сосын – Жанқұлы, тасқа басқан мөрі, Қожамбет, Айт – ұрпақтың биік төрі.\n
                    Одан соң – Жәнілмәмбет, әділдік ұраны, Құдыс пен Байшора, шежіренің құраны.\n
                    Арада жарқ еткен Жарылғап батыр атам – Қазақтың намысы үшін қылышын сілтеген.\n
                    Есімді елдің аузында, дастандарға арқау, Осы текті жалғастыру – менің ұлы антым!\n
                    Шұқын, Үкі, Қоңырбай – тарихтың кезеңі, Рамазан – із қалдырған өмірдің өзегі.\n
                    Атам – Қабыкен, ақылым, тіреуім, Әкем – Төреғали, ерлікпен жүремін.\n
                    Қазіргі күн – Найманның қос қанаты, Әкемнің жалғасы, екі ұлының талабы.\n
                    Қуаныш – үлкенім, тегін білген парасат, ал мен – Сағыныш, рухты көкке қарат!\n
                    Мен – тек қана бір адам емес, бір тарихпын, Атамның аманатын, батырдың айбынын сақтаймын.\n
                    Найман Қаракерей ұрпағы, мақтанышым – тегім, Жеті атамды айту – менің DNA-кодым!\n
                    \n<span class='author-sign'>~ Қабыкенов Сағыныш</span>"
                    data-lang-ru="
                    Мы казахи, наши корни взяли начало от Алаша,\n
                    Великая степь, поделенная на три жуза.\n
                    Мой род – Средний жуз, славное копье,\n
                    Сердце, пылающее огнем, особенный сын казахов!\n
                    Мой уран – Каптагай, знамя, стоящее надо мной,\n
                    Я Найман Каракее, знающий свой род.\n
                    Перечислил шестнадцать предков, тянущихся, как караван,\n
                    Продолжая жизнь, опережая горизонт!\n
                    Самый первый – Байторы, в глубине истории, Келеды – Айрам, великое дело в народе.\n
                    Затем – Жанкулы, печать, оставленная в камне, Кожамбет, Айт – высокий трон потомков.\n
                    А потом – Жанилмамбет, знамя справедливости, Кудус и Байшора, свиток истории.\n
                    Мой предок батыр Жарылгап, сияющий среди них – за честь казахов обнажал свой меч.\n
                    Имя его на устах народа, опора для дастанов, Продолжение этого рода – моя великая клятва!\n
                    Шукын, Уки, Конырбай – исторические этапы, Рамазан – стержень жизни, оставивший след.\n
                    Мой дед – Кабыкен, мой разум, моя опора, Мой отец – Торегали, я иду с мужеством.\n
                    Сегодня – два крыла Наймана, продолжение отца, стремление двух сыновей.\n
                    Куаныш – мой старший, знающий род, а я – Сагыныш, направляющий дух в небеса!\n
                    Я – не просто человек, я – история, наследие предка, хранящий славу батыра.\n
                    Потомок Наймана Каракее, моя гордость – мой род, назвать семь предков – мой DNA-код!\n
                    \n<span class='author-sign'>~ Кабыкенов Сагыныш</span>">
                    </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="language-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeLanguageModal()">&times;</span>
            <h3 data-key="select_language">Тілді таңдау / Выберите язык</h3>
            <div id="lang-options-container">
                <div class="lang-option selected" data-lang="kk-Cyrl">
                    <i class="fas fa-font"></i> Қазақ тілі (Кирилл)
                </div>
                <div class="lang-option" data-lang="ru">
                    <i class="fas fa-globe"></i> Русский язык
                </div>
            </div>
        </div>
    </div>

    <script>
        // Тіркелген аудармалар (index.html-дан алынған)
        const translations = {
            'kk-Cyrl': {
                site_title: 'ҮМІТ | Аудио Плеер (Неон)',
                back_link: 'Артқа Қайту (Негізгі Бет)', audio_player_title: 'Аудио Өлеңдер Плеері',
                select_track: 'Тректі таңдаңыз', playlist_title: 'Өлеңдер Тізімі:', search_placeholder: 'Өлең атауын іздеу...',
                track1_title: '1. Orta júz', track2_title: '2. Jarylgap batyr', track3_title: '3. Тегімнің рухы',
                lyrics_btn: 'Мәтін', lyrics_close: 'Жабу'
            },
            'ru': {
                site_title: 'ÚMIT | Аудио Плеер (Неон)',
                back_link: 'Вернуться (Главная)', audio_player_title: 'Аудиоплеер Песен',
                select_track: 'Выберите трек', playlist_title: 'Список Песен:', search_placeholder: 'Поиск названия песни...',
                track1_title: '1. Средний жуз', track2_title: '2. Жарылгап батыр', track3_title: '3. Дух моего рода',
                lyrics_btn: 'Текст', lyrics_close: 'Закрыть'
            }
        };

        const playlistData = [
            { title: '1. Orta júz', src: 'orta_juz_audio.mp3' },
            { title: '2. Jarylgap batyr', src: 'jarylgap_batyr.mp3' },
            { title: '3. Тегімнің рухы', src: 'tegimnin_ruhy.mp3' }
        ];

        const audioPlayer = document.getElementById('global-audio-player');
        const playBtn = document.getElementById('main-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const trackTitleEl = document.getElementById('current-track-title');
        const playlistItems = document.querySelectorAll('.playlist-item');
        const searchInput = document.getElementById('playlist-search');

        let currentTrackIndex = -1;
        let isPlaying = false;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // ⚠️ Плеерді жүктеу және тректі ойнату
        function loadTrack(index) {
            if (index < 0 || index >= playlistData.length) return;

            // Бұрынғы ойнатылып тұрған тректен 'playing' классын алып тастау
            if (currentTrackIndex >= 0) {
                playlistItems[currentTrackIndex].classList.remove('playing');
            }

            currentTrackIndex = index;
            const track = playlistData[index];
            
            // Жаңа тректі жүктеу
            audioPlayer.src = track.src;
            audioPlayer.load();

            // Жаңа трекке 'playing' классын қосу
            playlistItems[currentTrackIndex].classList.add('playing');

            // Аударманы қолдану арқылы тақырыпты жаңарту
            const lang = localStorage.getItem('selectedLang') || 'kk-Cyrl';
            const trackKey = `track${index + 1}_title`;
            trackTitleEl.textContent = translations[lang][trackKey] || track.title;
            
            // Мәтін аймағын жабу
            document.querySelectorAll('.lyrics-content.open').forEach(el => el.classList.remove('open'));
            document.querySelectorAll('.lyrics-toggle-btn').forEach(btn => btn.textContent = translations[lang]['lyrics_btn']);

            // Егер бұрын ойнатылған болса, жаңасын бірден ойнату
            if (isPlaying) {
                audioPlayer.play().catch(error => {
                    console.error("Autoplay failed:", error);
                });
            }
        }
        
        // ⚠️ Ойнату/Тоқтату функциясы
        function togglePlay() {
            if (currentTrackIndex === -1) {
                // Егер трек таңдалмаса, біріншісін жүктеу және ойнату
                loadTrack(0);
                isPlaying = true; // loadTrack() ішінде play() шақырылады
            } else if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
            } else {
                audioPlayer.play().catch(error => {
                    console.error("Play failed:", error);
                });
                isPlaying = true;
            }
            updatePlayButton();
        }

        function updatePlayButton() {
            const icon = playBtn.querySelector('i');
            icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        }

        function skipTime(seconds) {
            if (currentTrackIndex === -1) return;
            audioPlayer.currentTime += seconds;
        }

        // Тректі таңдау логикасы
        playlistItems.forEach((item, index) => {
            item.addEventListener('click', () => {
                if (index !== currentTrackIndex) {
                    loadTrack(index);
                    isPlaying = true; 
                    audioPlayer.play();
                    updatePlayButton();
                } else if (!isPlaying) {
                    togglePlay();
                }
            });
        });

        // Event Listeners
        audioPlayer.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audioPlayer.duration);
            progressBar.max = audioPlayer.duration;
            
            // Плейлистегі ұзақтығын жаңарту
            playlistItems.forEach((item, index) => {
                if(index === currentTrackIndex) {
                    item.querySelector('.item-duration').textContent = formatTime(audioPlayer.duration);
                }
            });
        });

        audioPlayer.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            progressBar.value = audioPlayer.currentTime;
        });

        audioPlayer.addEventListener('play', () => {
            isPlaying = true;
            updatePlayButton();
        });

        audioPlayer.addEventListener('pause', () => {
            isPlaying = false;
            updatePlayButton();
        });

        audioPlayer.addEventListener('ended', () => {
            // Келесі трекке өту логикасы
            let nextIndex = (currentTrackIndex + 1) % playlistData.length;
            loadTrack(nextIndex);
            audioPlayer.play();
            updatePlayButton();
        });

        progressBar.addEventListener('input', () => {
            audioPlayer.currentTime = progressBar.value;
        });
        
        // ⚠️ МӘТІН АШУ/ЖАБУ ФУНКЦИЯСЫ
        function toggleLyrics(button) {
            const currentLang = localStorage.getItem('selectedLang') || 'kk-Cyrl';
            const currentLangTr = translations[currentLang];
            const lyricsContent = button.closest('.playlist-item').querySelector('.lyrics-content');
            
            if (!lyricsContent) return;

            // Басқа ашық мәтіндерді жабу
            document.querySelectorAll('.lyrics-content').forEach(content => {
                const item = content.closest('.playlist-item');
                const otherBtn = item.querySelector('.lyrics-toggle-btn');
                
                if (content !== lyricsContent && content.classList.contains('open')) {
                    content.classList.remove('open');
                    if (otherBtn) otherBtn.textContent = currentLangTr['lyrics_btn'];
                }
            });

            lyricsContent.classList.toggle('open');
            
            if (lyricsContent.classList.contains('open')) {
                button.textContent = currentLangTr['lyrics_close'] || 'Жабу';
            } else {
                button.textContent = currentLangTr['lyrics_btn'] || 'Мәтін';
            }
        }
        
        // Плейлисті сүзу
        function filterPlaylist() {
            const filter = searchInput.value.toLowerCase();
            playlistItems.forEach(item => {
                const text = item.querySelector('span').textContent.toLowerCase();
                if (text.includes(filter)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Тілді ауыстыру функциялары
        const profileDropdown = document.getElementById('profile-dropdown');
        const langModal = document.getElementById('language-modal');
        
        function toggleProfileDropdown() {
            profileDropdown.classList.toggle('open');
        }

        function openLanguageModal() {
            const currentLang = localStorage.getItem('selectedLang') || 'kk-Cyrl';
            document.querySelectorAll('.lang-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.getAttribute('data-lang') === currentLang) {
                    opt.classList.add('selected');
                }
            });
            langModal.style.display = 'flex';
        }

        function closeLanguageModal() {
            langModal.style.display = 'none';
        }

        document.getElementById('lang-options-container').addEventListener('click', function(e) {
            const option = e.target.closest('.lang-option');
            if (option) {
                const lang = option.getAttribute('data-lang');
                translatePage(lang);
                
                document.querySelectorAll('.lang-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                
                closeLanguageModal();
            }
        });

        // ⚠️ ТІЛ АУЫСТЫРУ ФУНКЦИЯСЫНДАҒЫ МӘТІН ЖҮКТЕУ ЛОГИКАСЫ
        function translatePage(lang) {
            const currentLang = translations[lang];
            if (!currentLang) return;

            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (currentLang[key]) {
                    el.textContent = currentLang[key];
                }
            });

            document.title = currentLang['site_title'] || document.title;
            
            // Өлең мәтіндерін аудару және жүктеу
            document.querySelectorAll('.lyrics-content').forEach(lyricDiv => {
                const langData = lyricDiv.getAttribute(`data-lang-${lang.toLowerCase()}`);
                if (langData) {
                    // Жаңа жолдарды (<br>) дұрыс енгізу
                    lyricDiv.innerHTML = langData.trim().replace(/\n/g, '<br>');
                }
            });
            
            // Мәтін түймелерін жаңарту
            document.querySelectorAll('.lyrics-toggle-btn').forEach(btn => {
                // Түйменің ашық/жабық күйін сақтай отырып, мәтінін аудару
                const isOpened = btn.closest('.playlist-item').querySelector('.lyrics-content').classList.contains('open');
                btn.textContent = isOpened ? currentLang['lyrics_close'] : currentLang['lyrics_btn'];
            });


            localStorage.setItem('selectedLang', lang);
            document.documentElement.lang = lang;
            
            const backLink = document.querySelector('.back-link');
            if(backLink) {
                backLink.href = `index.html?lang=${lang}`;
            }
            
            // Егер ойнатылып тұрса, тақырыпты жаңарту
            if (currentTrackIndex !== -1) {
                 const trackKey = `track${currentTrackIndex + 1}_title`;
                 trackTitleEl.textContent = currentLang[trackKey] || playlistData[currentTrackIndex].title;
            } else {
                 trackTitleEl.textContent = currentLang['select_track'];
            }
        }
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlLang = urlParams.get('lang');
            const savedLang = localStorage.getItem('selectedLang') || 'kk-Cyrl';
            
            const initialLang = urlLang || savedLang;
            
            translatePage(initialLang);
        }
    </script>

</body>
</html>